<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Guide - Smart Mapper V4</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 2rem;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #4a5568, #38a169);
            color: white;
            padding: 2.5rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 51, 102, 0.2);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .header p {
            font-size: 1.15rem;
            opacity: 0.95;
        }

        .section {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #4a5568;
        }

        .section h2 {
            color: #4a5568;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            border-bottom: 2px solid #38a169;
            padding-bottom: 0.5rem;
        }

        .section h3 {
            color: #4a5568;
            margin: 1.5rem 0 1rem 0;
            font-size: 1.3rem;
        }

        .section p {
            margin-bottom: 1rem;
            color: #555;
        }

        .section ul, .section ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .section ul li, .section ol li {
            margin: 0.5rem 0;
            color: #555;
        }

        .tip-box {
            background: linear-gradient(135deg, #e8f4fd, #d4edda);
            padding: 1.25rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #38a169;
        }

        .tip-box strong {
            color: #4a5568;
            font-size: 1.05rem;
        }

        .warning-box {
            background: linear-gradient(135deg, #fff3cd, #ffe8a1);
            padding: 1.25rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning-box strong {
            color: #856404;
            font-size: 1.05rem;
        }

        code {
            background: #f1f1f1;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #c7254e;
            font-size: 0.9rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        table th {
            background: #4a5568;
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 0.75rem;
            border-bottom: 1px solid #dee2e6;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        .toc {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .toc h2 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc ul li {
            margin: 0.5rem 0;
        }

        .toc ul li a {
            color: #38a169;
            text-decoration: none;
            font-weight: 500;
        }

        .toc ul li a:hover {
            text-decoration: underline;
        }

        .workflow-box {
            background: linear-gradient(135deg, #f0f8ff, #e8f4fd);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1rem 0;
            border: 2px solid #4a5568;
        }

        .workflow-box h4 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìñ Smart Mapper V4 User Guide</h1>
            <p>Target-First Mapping Workflow</p>
        </div>

        <div class="toc">
            <h2>üìë Table of Contents</h2>
            <ul>
                <li><a href="#overview">1. Overview</a></li>
                <li><a href="#getting-started">2. Getting Started</a></li>
                <li><a href="#create-project">3. Creating a Project</a></li>
                <li><a href="#upload-sources">4. Uploading Source Fields</a></li>
                <li><a href="#discovery">5. AI Discovery</a></li>
                <li><a href="#review-suggestions">6. Reviewing Suggestions</a></li>
                <li><a href="#actions">7. Suggestion Actions</a></li>
                <li><a href="#best-practices">8. Best Practices</a></li>
                <li><a href="#troubleshooting">9. Troubleshooting</a></li>
            </ul>
        </div>

        <div class="section" id="overview">
            <h2>1. Overview</h2>
            <p><strong>Smart Mapper V4</strong> uses a <strong>Target-First</strong> workflow for data mapping. Instead of mapping one source field at a time, you work through entire target tables with AI assistance.</p>
            
            <h3>Target-First vs Source-First</h3>
            <table>
                <tr>
                    <th>Traditional (Source-First)</th>
                    <th>V4 (Target-First)</th>
                </tr>
                <tr>
                    <td>Select a source field</td>
                    <td>Create a project</td>
                </tr>
                <tr>
                    <td>Search for matching target</td>
                    <td>Upload ALL source fields at once</td>
                </tr>
                <tr>
                    <td>Configure the mapping</td>
                    <td>Select a target table to map</td>
                </tr>
                <tr>
                    <td>Repeat for each field</td>
                    <td>AI suggests mappings for ALL columns</td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>Review, approve, or edit each suggestion</td>
                </tr>
            </table>

            <h3>Key Benefits</h3>
            <ul>
                <li>‚úÖ <strong>Complete Coverage:</strong> See ALL target columns upfront, nothing missed</li>
                <li>‚úÖ <strong>AI-Powered:</strong> Suggestions for entire tables, not just one field</li>
                <li>‚úÖ <strong>Pattern Learning:</strong> AI uses historical mappings to suggest complex SQL</li>
                <li>‚úÖ <strong>Progress Tracking:</strong> Clear dashboard showing tables complete vs. remaining</li>
                <li>‚úÖ <strong>Team Collaboration:</strong> Multiple users can work on different tables</li>
            </ul>
        </div>

        <div class="section" id="getting-started">
            <h2>2. Getting Started</h2>
            
            <h3>Accessing the Application</h3>
            <ol>
                <li>Navigate to your Databricks App URL</li>
                <li>You will be automatically authenticated using your Databricks account</li>
                <li>Your email is displayed in the header (top-right)</li>
            </ol>

            <h3>Navigation</h3>
            <p>The sidebar has two main sections:</p>

            <p><strong>üìä Mapping Workflow</strong></p>
            <ul>
                <li>üè† <strong>Projects</strong> - Main dashboard, all your projects</li>
            </ul>

            <p><strong>üîß Administration</strong> (Admins Only)</p>
            <ul>
                <li>üíæ <strong>Semantic Fields</strong> - Manage target field definitions</li>
                <li>üì• <strong>Pattern Import</strong> - Bulk load historical patterns</li>
                <li>‚öôÔ∏è <strong>Configuration</strong> - System settings</li>
            </ul>
        </div>

        <div class="section" id="create-project">
            <h2>3. Creating a Project</h2>
            
            <h3>Step 1: Click "New Project"</h3>
            <p>From the Projects dashboard, click the <strong>"+ New Project"</strong> button.</p>

            <h3>Step 2: Fill Project Details</h3>
            <ul>
                <li><strong>Project Name:</strong> Descriptive name (e.g., "DMES Member Migration Q1 2025")</li>
                <li><strong>Description:</strong> Details about the migration project</li>
                <li><strong>Source System:</strong> Name of the source system (e.g., "DMES", "MMIS")</li>
                <li><strong>Target Domains:</strong> Filter target tables by domain (e.g., "Member", "Member|Claims")</li>
            </ul>

            <h3>Step 3: Add Team Members (Optional)</h3>
            <p>Enter email addresses of colleagues who should have access to this project. Team members will see this project in their dashboard and can work on tables.</p>

            <h3>Step 4: Save</h3>
            <p>Click <strong>"Create Project"</strong>. You'll be taken to the project detail page.</p>
        </div>

        <div class="section" id="upload-sources">
            <h2>4. Uploading Source Fields</h2>
            
            <h3>Why Upload All Sources First?</h3>
            <p>The AI needs to know ALL your available source fields to make good suggestions. It matches target columns to the most semantically similar source columns.</p>

            <h3>Step 1: Download the Template</h3>
            <ol>
                <li>On the project detail page, click <strong>"Upload Sources"</strong></li>
                <li>Click <strong>"Download Template"</strong> to get the CSV format</li>
            </ol>

            <h3>Step 2: Fill the Template</h3>
            <table>
                <tr>
                    <th>Column</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>src_table_name</code></td>
                    <td>‚úÖ</td>
                    <td>Logical table name</td>
                </tr>
                <tr>
                    <td><code>src_table_physical_name</code></td>
                    <td>‚úÖ</td>
                    <td>Physical table name</td>
                </tr>
                <tr>
                    <td><code>src_column_name</code></td>
                    <td>‚úÖ</td>
                    <td>Logical column name</td>
                </tr>
                <tr>
                    <td><code>src_column_physical_name</code></td>
                    <td>‚úÖ</td>
                    <td>Physical column name</td>
                </tr>
                <tr>
                    <td><code>src_physical_datatype</code></td>
                    <td>‚úÖ</td>
                    <td>Data type (STRING, INT, DATE)</td>
                </tr>
                <tr>
                    <td><code>src_comments</code></td>
                    <td>‚ö†Ô∏è CRITICAL</td>
                    <td>Description - essential for AI matching</td>
                </tr>
                <tr>
                    <td><code>domain</code></td>
                    <td>Optional</td>
                    <td>Domain category</td>
                </tr>
            </table>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Important:</strong> The <code>src_comments</code> field is <strong>essential</strong> for AI matching. Without good descriptions, the AI cannot find the best source columns for your target fields.
            </div>

            <h3>Step 3: Upload the CSV</h3>
            <ol>
                <li>Click <strong>"Select CSV File"</strong></li>
                <li>Choose your completed template</li>
                <li>Click <strong>"Upload"</strong></li>
            </ol>
        </div>

        <div class="section" id="discovery">
            <h2>5. AI Discovery</h2>
            
            <h3>What AI Discovery Does</h3>
            <p>When you start discovery for a table, the AI:</p>
            <ol>
                <li>Looks at each target column in that table</li>
                <li>Searches for past mapping patterns from historical mappings</li>
                <li>Finds matching source columns from your uploaded fields using vector search</li>
                <li>Uses an LLM to rewrite the SQL with your source columns</li>
                <li>Creates suggestions with confidence scores</li>
            </ol>

            <h3>Starting Discovery</h3>
            <ol>
                <li>On the project detail page, find the target table you want to map</li>
                <li>Click the <strong>"Discover"</strong> button</li>
                <li>The button changes to <strong>"Discovering..."</strong> with a spinner</li>
                <li>Watch progress update in real-time (e.g., "DISCOVERING 5/25")</li>
                <li>When complete, status changes to <strong>"SUGGESTIONS_READY"</strong></li>
            </ol>

            <h3>Discovery Time</h3>
            <ul>
                <li><strong>Small tables (10-20 columns):</strong> 1-2 minutes</li>
                <li><strong>Medium tables (20-50 columns):</strong> 2-5 minutes</li>
                <li><strong>Large tables (50+ columns):</strong> 5-10 minutes</li>
            </ul>

            <div class="tip-box">
                <strong>üí° Tip:</strong> You can navigate to other tables or pages while discovery runs in the background.
            </div>
        </div>

        <div class="section" id="review-suggestions">
            <h2>6. Reviewing Suggestions</h2>
            
            <h3>Suggestion Panel</h3>
            <p>Click on a table with "SUGGESTIONS_READY" status to open the review panel. Suggestions are sorted alphabetically by column name.</p>

            <p>Each suggestion shows:</p>
            <ul>
                <li><strong>Target Column:</strong> Name and physical name</li>
                <li><strong>Confidence Score:</strong> AI's confidence in the match (0-100%)</li>
                <li><strong>Pattern Type:</strong> SINGLE, JOIN, UNION, UNION_JOIN</li>
                <li><strong>Matched Sources:</strong> Source fields the AI found</li>
                <li><strong>SQL Expression:</strong> The generated mapping SQL</li>
                <li><strong>Warnings:</strong> Any issues that need attention</li>
            </ul>

            <h3>Confidence Scores</h3>
            <table>
                <tr>
                    <th>Score</th>
                    <th>Indicator</th>
                    <th>Meaning</th>
                </tr>
                <tr>
                    <td>85-100%</td>
                    <td>‚úÖ Green</td>
                    <td>High confidence - likely correct</td>
                </tr>
                <tr>
                    <td>70-84%</td>
                    <td>‚ö†Ô∏è Yellow</td>
                    <td>Medium confidence - review carefully</td>
                </tr>
                <tr>
                    <td>50-69%</td>
                    <td>üü† Orange</td>
                    <td>Low confidence - needs attention</td>
                </tr>
                <tr>
                    <td>0-49%</td>
                    <td>‚ùå Red</td>
                    <td>Very low - consider manual mapping</td>
                </tr>
            </table>

            <h3>Special Case Suggestions</h3>
            <p>Some patterns are auto-handled based on their source expression:</p>
            <table>
                <tr>
                    <th>Pattern Type</th>
                    <th>What It Means</th>
                    <th>Action</th>
                </tr>
                <tr>
                    <td><strong>AUTO_MAPPED</strong></td>
                    <td>Field is auto-generated (e.g., identity column)</td>
                    <td>No SQL needed, just approve</td>
                </tr>
                <tr>
                    <td><strong>HARDCODED</strong></td>
                    <td>Fixed value like NULL or a constant</td>
                    <td>Review the value, approve if correct</td>
                </tr>
                <tr>
                    <td><strong>N/A</strong></td>
                    <td>Field not applicable for this migration</td>
                    <td>Review and skip if not needed</td>
                </tr>
            </table>
        </div>

        <div class="section" id="actions">
            <h2>7. Suggestion Actions</h2>
            
            <h3>Approve</h3>
            <p>Click <strong>"Approve"</strong> when the suggestion is correct as-is.</p>
            <ul>
                <li>Creates a row in <code>mapped_fields</code></li>
                <li>Updates the source fields to MAPPED status</li>
                <li>Increments the table's columns_mapped counter</li>
            </ul>

            <h3>Edit (Review & Edit)</h3>
            <p>Click <strong>"Edit"</strong> to modify the SQL before approving.</p>
            <ol>
                <li>SQL editor opens with the suggested expression</li>
                <li>Make your changes</li>
                <li>Click <strong>"Save & Approve"</strong></li>
            </ol>

            <div class="tip-box">
                <strong>üí° When to Edit:</strong>
                <ul>
                    <li>Fix incorrect column references</li>
                    <li>Adjust transformations (TRIM, UPPER, etc.)</li>
                    <li>Modify filter/WHERE conditions</li>
                    <li>Change JOIN types</li>
                </ul>
            </div>

            <h3>Reject</h3>
            <p>Click <strong>"Reject"</strong> when the suggestion is fundamentally wrong.</p>
            <ol>
                <li>A dialog asks for rejection reason</li>
                <li>Provide feedback (helps improve AI)</li>
                <li>Click <strong>"Confirm Reject"</strong></li>
            </ol>

            <h3>Skip</h3>
            <p>Click <strong>"Skip"</strong> when:</p>
            <ul>
                <li>Column is not needed in this migration</li>
                <li>Will be mapped manually later</li>
                <li>No source data exists for this field</li>
            </ul>

            <h3>Regenerate</h3>
            <p>Click the <strong>refresh icon</strong> to re-run AI discovery for a single column. Useful if you've added new source fields or patterns.</p>
        </div>

        <div class="section" id="best-practices">
            <h2>8. Best Practices</h2>
            
            <h3>For Efficient Mapping</h3>
            <ul>
                <li>‚úÖ <strong>Upload complete source data</strong> with good descriptions</li>
                <li>‚úÖ <strong>Start with high-priority tables</strong> (core entities first)</li>
                <li>‚úÖ <strong>Work table by table</strong> rather than jumping around</li>
                <li>‚úÖ <strong>Provide feedback on rejections</strong> to improve AI</li>
            </ul>

            <h3>For Quality Mappings</h3>
            <ul>
                <li>‚úÖ <strong>Review SQL carefully</strong> - especially JOINs and filters</li>
                <li>‚úÖ <strong>Check data types match</strong> between source and target</li>
                <li>‚úÖ <strong>Verify transformations</strong> are appropriate (TRIM, UPPER, etc.)</li>
                <li>‚úÖ <strong>Test with sample data</strong> when possible</li>
            </ul>

            <h3>For Team Collaboration</h3>
            <ul>
                <li>‚úÖ <strong>Assign table ownership</strong> to avoid conflicts</li>
                <li>‚úÖ <strong>Use project notes</strong> to communicate status</li>
                <li>‚úÖ <strong>Review each other's mappings</strong> before marking complete</li>
            </ul>
        </div>

        <div class="section" id="troubleshooting">
            <h2>9. Troubleshooting</h2>
            
            <h3>Discovery Fails or Takes Too Long</h3>
            <ul>
                <li>Check system status on Home page</li>
                <li>Verify source fields have been uploaded</li>
                <li>LLM endpoint may need warmup on first request</li>
                <li>Large tables take longer - be patient</li>
            </ul>

            <h3>No Suggestions or Poor Matches</h3>
            <ul>
                <li>Check source field descriptions are complete</li>
                <li>Verify historical patterns exist for this table</li>
                <li>Add more source fields if some are missing</li>
                <li>Use manual mapping for edge cases</li>
            </ul>

            <h3>Button Seems Stuck</h3>
            <ul>
                <li>Buttons show loading spinners when processing</li>
                <li>All buttons disable during operations to prevent double-clicks</li>
                <li>Wait for the operation to complete</li>
                <li>Refresh the page if truly stuck</li>
            </ul>

            <h3>Can't See a Project</h3>
            <ul>
                <li>Ask the project owner to add your email to team members</li>
                <li>Verify you're using the correct email address</li>
            </ul>

            <div class="tip-box">
                <strong>üí° Still Need Help?</strong> Contact your system administrator with:
                <ul>
                    <li>Screenshot of the issue</li>
                    <li>What you were trying to do</li>
                    <li>Any error messages you saw</li>
                </ul>
            </div>
        </div>

        <div class="section" style="background: linear-gradient(135deg, #e8f4fd, #f0f8ff); border-left-color: #38a169;">
            <h2>üéØ Quick Reference</h2>
            <table>
                <tr>
                    <th>Task</th>
                    <th>Location</th>
                    <th>Action</th>
                </tr>
                <tr>
                    <td>Create new project</td>
                    <td>Projects page</td>
                    <td>Click "+ New Project"</td>
                </tr>
                <tr>
                    <td>Upload source fields</td>
                    <td>Project detail page</td>
                    <td>Click "Upload Sources"</td>
                </tr>
                <tr>
                    <td>Start AI discovery</td>
                    <td>Project detail page</td>
                    <td>Click "Discover" on a table</td>
                </tr>
                <tr>
                    <td>Review suggestions</td>
                    <td>Project detail page</td>
                    <td>Click on a table row</td>
                </tr>
                <tr>
                    <td>Approve mapping</td>
                    <td>Suggestion panel</td>
                    <td>Click "Approve" or "Edit"</td>
                </tr>
                <tr>
                    <td>Export mappings</td>
                    <td>Project detail page</td>
                    <td>Click "Export Mappings"</td>
                </tr>
                <tr>
                    <td>Check system status</td>
                    <td>Home page</td>
                    <td>Review status indicators</td>
                </tr>
            </table>
            <p style="margin-top: 1rem; text-align: center; color: #666;">
                <strong>Version:</strong> Smart Mapper V4 - Target-First Workflow | <strong>Updated:</strong> December 2025
            </p>
        </div>
    </div>
</body>
</html>
