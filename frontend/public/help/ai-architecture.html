<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Mapper - AI Architecture</title>
    <style>
        :root {
            --primary: #10b981;
            --primary-dark: #059669;
            --secondary: #6366f1;
            --accent: #f59e0b;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #1a1a2e 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        header {
            text-align: center;
            padding: 3rem 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 3rem;
        }
        
        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        
        header p {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }
        
        .version-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 1rem;
        }
        
        .section {
            margin-bottom: 4rem;
        }
        
        .section-title {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary);
            display: inline-block;
        }
        
        /* Three Pillars */
        .pillars {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .pillar {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .pillar:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .pillar-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .pillar h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
        }
        
        .pillar-subtitle {
            color: var(--accent);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }
        
        .pillar p {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }
        
        .pillar ul {
            list-style: none;
            padding: 0;
        }
        
        .pillar ul li {
            padding: 0.3rem 0;
            color: var(--text-secondary);
        }
        
        .pillar ul li::before {
            content: "â†’ ";
            color: var(--primary);
        }
        
        .pillar.primary { border-top: 4px solid var(--primary); }
        .pillar.learning { border-top: 4px solid var(--secondary); }
        .pillar.avoid { border-top: 4px solid #ef4444; }
        
        /* Flow Diagram */
        .flow-container {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid var(--border);
            overflow-x: auto;
        }
        
        .flow-step {
            display: flex;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }
        
        .flow-step:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .step-number {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            flex-shrink: 0;
            margin-right: 1.5rem;
        }
        
        .step-content h4 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }
        
        .step-content p {
            color: var(--text-secondary);
        }
        
        .step-visual {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            border: 1px solid var(--border);
        }
        
        /* Parallel Searches Visual */
        .parallel-searches {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .parallel-searches.three-col {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .search-box {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            border: 2px solid var(--border);
        }
        
        .search-box.semantic { border-color: var(--primary); }
        .search-box.patterns { border-color: var(--secondary); }
        .search-box.rejections { border-color: #ef4444; }
        
        .search-box h5 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        .search-box ul {
            list-style: none;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        /* Data Structure Tables */
        .table-container {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border);
            overflow-x: auto;
        }
        
        .table-container h4 {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .table-container h4 .badge {
            background: var(--accent);
            color: var(--bg-dark);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .badge.vector {
            background: var(--secondary);
            color: white;
        }
        
        .badge.new {
            background: var(--primary);
            color: white;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        th {
            background: var(--bg-dark);
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        
        td {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        td code {
            background: var(--bg-dark);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Consolas', monospace;
            font-size: 0.85rem;
            color: var(--accent);
        }
        
        /* Benefits Grid */
        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .benefit {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }
        
        .benefit-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .benefit h4 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .benefit p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Comparison */
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .comparison-box {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }
        
        .comparison-box.before {
            border-top: 4px solid #ef4444;
        }
        
        .comparison-box.after {
            border-top: 4px solid var(--primary);
        }
        
        .comparison-box h4 {
            margin-bottom: 1rem;
        }
        
        .comparison-box pre {
            background: var(--bg-dark);
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 0.85rem;
        }
        
        /* Stage boxes */
        .stage-box {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
        }
        
        .stage-box h5 {
            color: var(--primary);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--border);
            margin-top: 3rem;
            color: var(--text-secondary);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .parallel-searches, .parallel-searches.three-col {
                grid-template-columns: 1fr;
            }
            
            .comparison {
                grid-template-columns: 1fr;
            }
            
            header h1 {
                font-size: 1.8rem;
            }
        }
        
        /* Arrow Animation */
        .arrow-down {
            text-align: center;
            font-size: 2rem;
            color: var(--primary);
            margin: 1rem 0;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(10px); }
        }
        
        /* Highlight box */
        .highlight-box {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(99, 102, 241, 0.15) 100%);
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§  Smart Mapper AI Architecture</h1>
            <p>Intelligent Data Field Mapping powered by Vector Search & LLM</p>
            <div class="version-badge">V3 - Simplified Schema</div>
        </header>
        
        <!-- Executive Summary -->
        <section class="section">
            <h2 class="section-title">Executive Summary</h2>
            <p style="font-size: 1.1rem; max-width: 900px;">
                Smart Mapper uses a <strong>Hybrid AI approach</strong> combining vector search and LLM reasoning 
                to intelligently suggest data field mappings from source systems to target schemas. 
                The system learns from historical patterns and user feedback, with each mapping stored as a 
                <strong>single row with a complete SQL expression</strong> for maximum flexibility.
            </p>
            
            <div class="highlight-box">
                <h4 style="margin-bottom: 0.5rem;">ğŸ¯ Key Innovation: Single Row = Complete Mapping</h4>
                <p style="color: var(--text-secondary);">
                    Instead of complex multi-table relationships, each mapping is stored as one row with a SQL expression 
                    that captures all transformations, joins, and unions. This simplifies the data model and makes 
                    AI learning more effective.
                </p>
            </div>
        </section>
        
        <!-- The Problem We Solve -->
        <section class="section">
            <h2 class="section-title">The Problem We Solve</h2>
            <div class="table-container" style="border-left: 4px solid var(--accent);">
                <h4>ğŸ“‹ Challenge: Names Don't Match, But Descriptions Do</h4>
                <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                    Source table/column <strong>names are completely different</strong> from target names, 
                    but column <strong>descriptions ARE similar</strong>. We need to:
                </p>
                <ul style="color: var(--text-secondary); margin-left: 1.5rem; margin-bottom: 1rem;">
                    <li>Match source to target using description similarity</li>
                    <li>Learn transformations (TRIM, UPPER) from historical patterns</li>
                    <li>Detect single vs multi-field mappings</li>
                    <li>Suggest complete SQL expressions</li>
                    <li>Avoid previously rejected mappings</li>
                </ul>
                <div style="background: var(--bg-dark); padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.9rem;">
                    <strong style="color: var(--accent);">Example:</strong><br>
                    Source: <code>patient_data.mbr_ssn_num</code> ("Social security number of the patient")<br>
                    Target: <code>Member.SSN</code> ("Member social security number")<br><br>
                    <span style="color: var(--text-secondary);">Names don't match, but descriptions are semantically similar!</span>
                </div>
            </div>
        </section>
        
        <!-- Three Pillars -->
        <section class="section">
            <h2 class="section-title">The Three Pillars of AI Mapping</h2>
            <div class="pillars">
                <div class="pillar primary">
                    <div class="pillar-icon">ğŸ¯</div>
                    <h3>Semantic Fields</h3>
                    <div class="pillar-subtitle">Target Discovery</div>
                    <p>"What target fields match this source description?"</p>
                    <ul>
                        <li>Vector search on target definitions</li>
                        <li>Matches by description similarity</li>
                        <li>Data type consideration</li>
                        <li>Domain filtering</li>
                    </ul>
                </div>
                
                <div class="pillar learning">
                    <div class="pillar-icon">ğŸ“š</div>
                    <h3>Mapped Fields</h3>
                    <div class="pillar-subtitle">Pattern Learning</div>
                    <p>"How did we map similar sources before?"</p>
                    <ul>
                        <li>Vector search on past mappings</li>
                        <li>Complete SQL expressions</li>
                        <li>Transformation patterns</li>
                        <li>Multi-field combinations</li>
                    </ul>
                </div>
                
                <div class="pillar avoid">
                    <div class="pillar-icon">ğŸš«</div>
                    <h3>Rejection History</h3>
                    <div class="pillar-subtitle">Mistake Avoidance</div>
                    <p>"What should we NOT suggest?"</p>
                    <ul>
                        <li>Previously rejected mappings</li>
                        <li>User feedback reasoning</li>
                        <li>Prevents repeat mistakes</li>
                        <li>Exact lookup by target</li>
                    </ul>
                </div>
            </div>
        </section>
        
        <!-- Hybrid AI Workflow -->
        <section class="section">
            <h2 class="section-title">Hybrid AI Workflow (Two-Stage)</h2>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                We use a <strong>Hybrid approach</strong> that combines parallel vector search for discovery 
                with targeted exact lookups for context. This balances accuracy, performance, and cost.
            </p>
            
            <div class="flow-container">
                
                <!-- Stage 1 -->
                <div class="stage-box">
                    <h5>â•â•â• STAGE 1: PARALLEL DISCOVERY â•â•â•</h5>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Two vector searches run simultaneously to find potential targets
                    </p>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>User Selects Source Field</h4>
                        <p>User selects a source field (or multiple) to map</p>
                        <div class="step-visual">
                            â˜‘ <strong>mbr_ssn_num</strong> (STRING)<br>
                            &nbsp;&nbsp;&nbsp;Description: "Social security number of the patient"<br>
                            &nbsp;&nbsp;&nbsp;Table: patient_data
                        </div>
                    </div>
                </div>
                
                <div class="arrow-down">â†“</div>
                
                <div class="flow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Parallel Vector Searches</h4>
                        <p>Search targets AND historical patterns simultaneously using source description</p>
                        <div class="parallel-searches">
                            <div class="search-box semantic">
                                <h5>ğŸ¯ Vector Search: TARGETS</h5>
                                <p style="font-size: 0.8rem; color: var(--text-secondary);">semantic_fields table</p>
                                <ul>
                                    <li>SSN (92% match)</li>
                                    <li>Member_ID (45% match)</li>
                                    <li>Tax_ID (40% match)</li>
                                </ul>
                            </div>
                            <div class="search-box patterns">
                                <h5>ğŸ“š Vector Search: PATTERNS</h5>
                                <p style="font-size: 0.8rem; color: var(--text-secondary);">mapped_fields table</p>
                                <ul>
                                    <li>Similar: ssn_no â†’ SSN</li>
                                    <li>Transform: TRIM used</li>
                                    <li>Format: 9 chars</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="arrow-down">â†“</div>
                
                <div class="flow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Merge & Rank Candidates</h4>
                        <p>Combine results from both searches, rank by relevance</p>
                        <div class="step-visual">
                            <strong>Top Candidates:</strong><br>
                            1. SSN (from targets + confirmed by patterns)<br>
                            2. Member_ID (from targets only)<br>
                            3. Tax_ID (from targets only)
                        </div>
                    </div>
                </div>
                
                <!-- Stage 2 -->
                <div class="stage-box">
                    <h5>â•â•â• STAGE 2: TARGETED CONTEXT â•â•â•</h5>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Exact lookups for top candidates to get precise context
                    </p>
                </div>
                
                <div class="flow-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Exact Lookups for Top Targets</h4>
                        <p>Get detailed patterns and rejections for the top N target candidates</p>
                        <div class="parallel-searches">
                            <div class="search-box patterns">
                                <h5>ğŸ“‹ Exact: PATTERNS for SSN</h5>
                                <ul>
                                    <li>15 past mappings to SSN</li>
                                    <li>Common: TRIM(src)</li>
                                    <li>Sometimes: REPLACE(-, '')</li>
                                </ul>
                            </div>
                            <div class="search-box rejections">
                                <h5>ğŸš« Exact: REJECTIONS for SSN</h5>
                                <ul>
                                    <li>phone_num â†’ SSN (rejected)</li>
                                    <li>Reason: "Wrong field type"</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="arrow-down">â†“</div>
                
                <div class="flow-step">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h4>LLM Analysis</h4>
                        <p>Foundation Model analyzes all context and generates intelligent suggestions</p>
                        <div class="step-visual">
                            <strong>LLM Inputs:</strong><br>
                            â€¢ Source field info + description<br>
                            â€¢ Target candidates with scores<br>
                            â€¢ Historical patterns for each target<br>
                            â€¢ Previous rejections to avoid<br><br>
                            <strong>LLM Outputs:</strong><br>
                            â€¢ Ranked suggestions with confidence<br>
                            â€¢ Recommended SQL expression<br>
                            â€¢ Human-readable reasoning
                        </div>
                    </div>
                </div>
                
                <div class="arrow-down">â†“</div>
                
                <div class="flow-step">
                    <div class="step-number">6</div>
                    <div class="step-content">
                        <h4>Present AI Suggestion</h4>
                        <p>User sees ranked suggestions with SQL expressions they can edit</p>
                        <div class="step-visual">
                            <strong style="color: var(--primary);">ğŸ¯ TOP SUGGESTION (95% confidence)</strong><br><br>
                            Target: <code>Member.SSN</code><br>
                            Expression: <code>TRIM(patient_data.mbr_ssn_num)</code><br><br>
                            <em>"Based on 15 similar mappings, this source field maps to SSN. 
                            TRIM is recommended based on historical patterns."</em>
                        </div>
                    </div>
                </div>
                
                <div class="arrow-down">â†“</div>
                
                <div class="flow-step">
                    <div class="step-number">7</div>
                    <div class="step-content">
                        <h4>User Action â†’ Learning Loop</h4>
                        <p>User accepts, modifies, or rejects - system learns</p>
                        <div class="parallel-searches">
                            <div class="search-box" style="border-color: var(--primary);">
                                <h5>âœ“ Accept / Modify</h5>
                                <ul>
                                    <li>Save to mapped_fields</li>
                                    <li>SQL expression stored</li>
                                    <li>Available for future AI learning</li>
                                </ul>
                            </div>
                            <div class="search-box" style="border-color: #ef4444;">
                                <h5>âœ— Reject</h5>
                                <ul>
                                    <li>Save to mapping_feedback</li>
                                    <li>User reason captured</li>
                                    <li>AI avoids in future</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </section>
        
        <!-- Why Hybrid? -->
        <section class="section">
            <h2 class="section-title">Why the Hybrid Approach?</h2>
            <div class="comparison">
                <div class="comparison-box before">
                    <h4>âŒ Sequential Only</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Vector search targets first, then lookup history
                    </p>
                    <pre>Problem:
â€¢ History can't influence target selection
â€¢ May miss best target if not in top N
â€¢ Sequential = slower</pre>
                </div>
                <div class="comparison-box after">
                    <h4>âœ… Hybrid (Our Approach)</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Parallel discovery + targeted context
                    </p>
                    <pre>Benefits:
â€¢ History INFLUENCES target discovery
â€¢ Only 2 vector indexes needed
â€¢ Rejections use exact lookup (cheap)
â€¢ Best balance of accuracy/cost</pre>
                </div>
            </div>
        </section>
        
        <!-- Data Model -->
        <section class="section">
            <h2 class="section-title">V3 Data Model (Simplified)</h2>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                V3 simplifies the schema to just <strong>5 tables</strong>. Each mapping is a single row 
                with a SQL expression - no more complex multi-table joins.
            </p>
            
            <!-- Table 1: semantic_fields -->
            <div class="table-container">
                <h4>ğŸ¯ semantic_fields <span class="badge vector">VECTOR INDEXED</span></h4>
                <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                    Target field definitions. Vector-indexed for AI search by description.
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>semantic_field_id</code></td>
                            <td>BIGINT (PK)</td>
                            <td>Auto-generated primary key</td>
                        </tr>
                        <tr>
                            <td><code>tgt_table_name</code></td>
                            <td>STRING</td>
                            <td>Target table logical name</td>
                        </tr>
                        <tr>
                            <td><code>tgt_table_physical_name</code></td>
                            <td>STRING</td>
                            <td>Target table physical name</td>
                        </tr>
                        <tr>
                            <td><code>tgt_column_name</code></td>
                            <td>STRING</td>
                            <td>Target column logical name</td>
                        </tr>
                        <tr>
                            <td><code>tgt_column_physical_name</code></td>
                            <td>STRING</td>
                            <td>Target column physical name</td>
                        </tr>
                        <tr>
                            <td><code>tgt_physical_datatype</code></td>
                            <td>STRING</td>
                            <td>Data type (STRING, INT, DATE)</td>
                        </tr>
                        <tr>
                            <td><code>tgt_comments</code></td>
                            <td>STRING</td>
                            <td>Description - <strong>critical for AI matching</strong></td>
                        </tr>
                        <tr>
                            <td><code>domain</code></td>
                            <td>STRING</td>
                            <td>Domain category (claims, member, etc.)</td>
                        </tr>
                        <tr>
                            <td><code>semantic_field</code></td>
                            <td>STRING (computed)</td>
                            <td>ğŸ” Vector-searchable concatenated field</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Table 2: unmapped_fields -->
            <div class="table-container">
                <h4>ğŸ“¥ unmapped_fields</h4>
                <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                    Source fields awaiting mapping. The <code>src_comments</code> field drives AI matching.
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>unmapped_field_id</code></td>
                            <td>BIGINT (PK)</td>
                            <td>Auto-generated primary key</td>
                        </tr>
                        <tr>
                            <td><code>src_table_name</code></td>
                            <td>STRING</td>
                            <td>Source table logical name</td>
                        </tr>
                        <tr>
                            <td><code>src_table_physical_name</code></td>
                            <td>STRING</td>
                            <td>Source table physical name</td>
                        </tr>
                        <tr>
                            <td><code>src_column_name</code></td>
                            <td>STRING</td>
                            <td>Source column logical name</td>
                        </tr>
                        <tr>
                            <td><code>src_column_physical_name</code></td>
                            <td>STRING</td>
                            <td>Source column physical name</td>
                        </tr>
                        <tr>
                            <td><code>src_physical_datatype</code></td>
                            <td>STRING</td>
                            <td>Data type</td>
                        </tr>
                        <tr>
                            <td><code>src_comments</code></td>
                            <td>STRING</td>
                            <td>Description - <strong>critical for AI matching</strong></td>
                        </tr>
                        <tr>
                            <td><code>domain</code></td>
                            <td>STRING</td>
                            <td>Domain category</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Table 3: mapped_fields (THE KEY TABLE) -->
            <div class="table-container" style="border: 2px solid var(--primary);">
                <h4>âœ… mapped_fields <span class="badge vector">VECTOR INDEXED</span> <span class="badge new">SIMPLIFIED</span></h4>
                <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                    <strong>One row = one complete mapping.</strong> The SQL expression captures all logic.
                    Vector-indexed for AI pattern learning.
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>mapped_field_id</code></td>
                            <td>BIGINT (PK)</td>
                            <td>Auto-generated primary key</td>
                        </tr>
                        <tr>
                            <td><code>semantic_field_id</code></td>
                            <td>BIGINT (FK)</td>
                            <td>Reference to target field</td>
                        </tr>
                        <tr>
                            <td><code>tgt_table_name</code></td>
                            <td>STRING</td>
                            <td>Target table (denormalized)</td>
                        </tr>
                        <tr>
                            <td><code>tgt_column_name</code></td>
                            <td>STRING</td>
                            <td>Target column (denormalized)</td>
                        </tr>
                        <tr style="background: rgba(16, 185, 129, 0.1);">
                            <td><code>source_expression</code></td>
                            <td>STRING</td>
                            <td><strong>Complete SQL expression</strong> (e.g., "TRIM(t.col)")</td>
                        </tr>
                        <tr style="background: rgba(16, 185, 129, 0.1);">
                            <td><code>source_tables</code></td>
                            <td>STRING</td>
                            <td>Comma-separated source tables</td>
                        </tr>
                        <tr style="background: rgba(16, 185, 129, 0.1);">
                            <td><code>source_columns</code></td>
                            <td>STRING</td>
                            <td>Comma-separated source columns</td>
                        </tr>
                        <tr style="background: rgba(16, 185, 129, 0.1);">
                            <td><code>source_descriptions</code></td>
                            <td>STRING</td>
                            <td>Combined source descriptions</td>
                        </tr>
                        <tr style="background: rgba(16, 185, 129, 0.1);">
                            <td><code>source_relationship_type</code></td>
                            <td>STRING</td>
                            <td>SINGLE, JOIN, or UNION</td>
                        </tr>
                        <tr style="background: rgba(16, 185, 129, 0.1);">
                            <td><code>transformations_applied</code></td>
                            <td>STRING</td>
                            <td>Transformations used (TRIM, UPPER, etc.)</td>
                        </tr>
                        <tr>
                            <td><code>confidence_score</code></td>
                            <td>DOUBLE</td>
                            <td>AI confidence (0.0 - 1.0)</td>
                        </tr>
                        <tr>
                            <td><code>mapping_source</code></td>
                            <td>STRING</td>
                            <td>AI, MANUAL, or BULK_UPLOAD</td>
                        </tr>
                        <tr>
                            <td><code>ai_reasoning</code></td>
                            <td>STRING</td>
                            <td>AI explanation for suggestion</td>
                        </tr>
                        <tr>
                            <td><code>ai_generated</code></td>
                            <td>BOOLEAN</td>
                            <td>Was expression AI-generated?</td>
                        </tr>
                        <tr>
                            <td><code>mapped_by</code></td>
                            <td>STRING</td>
                            <td>User who created mapping</td>
                        </tr>
                        <tr style="background: rgba(99, 102, 241, 0.1);">
                            <td><code>source_semantic_field</code></td>
                            <td>STRING (computed)</td>
                            <td>ğŸ” Vector-searchable field for AI learning</td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-dark); border-radius: 8px;">
                    <strong style="color: var(--accent);">Example Mappings:</strong>
                    <pre style="margin-top: 0.5rem; font-size: 0.85rem; overflow-x: auto;">
Simple:     source_expression = "TRIM(patient.ssn)"
Multi-col:  source_expression = "CONCAT(TRIM(p.first), ' ', TRIM(p.last))"
With Join:  source_expression = "CASE WHEN a.type='HOME' THEN a.street END"
With Union: source_expression = "SELECT city FROM curr UNION SELECT city FROM hist"</pre>
                </div>
            </div>
            
            <!-- Table 4: mapping_feedback -->
            <div class="table-container">
                <h4>ğŸš« mapping_feedback <span class="badge vector">VECTOR INDEXED</span></h4>
                <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                    Rejected AI suggestions. Vector-indexed to help AI avoid similar mistakes.
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>feedback_id</code></td>
                            <td>BIGINT (PK)</td>
                            <td>Auto-generated primary key</td>
                        </tr>
                        <tr>
                            <td><code>suggested_src_table</code></td>
                            <td>STRING</td>
                            <td>Source table in rejected suggestion</td>
                        </tr>
                        <tr>
                            <td><code>suggested_src_column</code></td>
                            <td>STRING</td>
                            <td>Source column in rejected suggestion</td>
                        </tr>
                        <tr>
                            <td><code>suggested_tgt_table</code></td>
                            <td>STRING</td>
                            <td>Target table in rejected suggestion</td>
                        </tr>
                        <tr>
                            <td><code>suggested_tgt_column</code></td>
                            <td>STRING</td>
                            <td>Target column in rejected suggestion</td>
                        </tr>
                        <tr>
                            <td><code>src_comments</code></td>
                            <td>STRING</td>
                            <td>Source description at time of rejection</td>
                        </tr>
                        <tr>
                            <td><code>tgt_comments</code></td>
                            <td>STRING</td>
                            <td>Target description at time of rejection</td>
                        </tr>
                        <tr>
                            <td><code>feedback_action</code></td>
                            <td>STRING</td>
                            <td>REJECTED or MODIFIED</td>
                        </tr>
                        <tr>
                            <td><code>user_comments</code></td>
                            <td>STRING</td>
                            <td>User's reason for rejection</td>
                        </tr>
                        <tr>
                            <td><code>feedback_by</code></td>
                            <td>STRING</td>
                            <td>User who rejected</td>
                        </tr>
                        <tr>
                            <td><code>source_semantic_field</code></td>
                            <td>STRING (computed)</td>
                            <td>ğŸ” Vector-searchable field</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Table 5: transformation_library -->
            <div class="table-container">
                <h4>âš™ï¸ transformation_library</h4>
                <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                    Predefined SQL transformations that AI can suggest.
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Column</th>
                            <th>Type</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>transformation_id</code></td>
                            <td>BIGINT (PK)</td>
                            <td>Auto-generated primary key</td>
                        </tr>
                        <tr>
                            <td><code>transformation_name</code></td>
                            <td>STRING</td>
                            <td>Display name (e.g., "Trim Whitespace")</td>
                        </tr>
                        <tr>
                            <td><code>transformation_code</code></td>
                            <td>STRING</td>
                            <td>Short code (e.g., "TRIM")</td>
                        </tr>
                        <tr>
                            <td><code>transformation_expression</code></td>
                            <td>STRING</td>
                            <td>SQL template (e.g., "TRIM({field})")</td>
                        </tr>
                        <tr>
                            <td><code>category</code></td>
                            <td>STRING</td>
                            <td>TEXT, DATE, NUMERIC, CUSTOM</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Entity Relationship Diagram -->
        <section class="section">
            <h2 class="section-title">Entity Relationships</h2>
            <div class="flow-container" style="text-align: center;">
                <pre style="text-align: left; display: inline-block; font-size: 0.85rem; line-height: 1.4;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      unmapped_fields        â”‚         â”‚      semantic_fields        â”‚
â”‚      (Source Fields)        â”‚         â”‚      (Target Fields)        â”‚
â”‚                             â”‚         â”‚                             â”‚
â”‚ â€¢ unmapped_field_id (PK)    â”‚         â”‚ â€¢ semantic_field_id (PK)    â”‚
â”‚ â€¢ src_table_name            â”‚         â”‚ â€¢ tgt_table_name            â”‚
â”‚ â€¢ src_column_name           â”‚         â”‚ â€¢ tgt_column_name           â”‚
â”‚ â€¢ src_comments              â”‚         â”‚ â€¢ tgt_comments              â”‚
â”‚ â€¢ src_datatype              â”‚         â”‚ â€¢ semantic_field ğŸ”         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â”‚ FK
                                                       â”‚
                                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          mapped_fields                                â”‚
â”‚                    (Complete Mappings - ONE ROW EACH)                 â”‚
â”‚                                                                       â”‚
â”‚ â€¢ mapped_field_id (PK)                                               â”‚
â”‚ â€¢ semantic_field_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
â”‚ â€¢ source_expression       â† "TRIM(patient.ssn)" - THE SQL!           â”‚
â”‚ â€¢ source_tables           â† "patient_data, address"                  â”‚
â”‚ â€¢ source_columns          â† "ssn, addr_line1"                        â”‚
â”‚ â€¢ source_descriptions     â† Combined for vector search               â”‚
â”‚ â€¢ source_relationship_typeâ† SINGLE / JOIN / UNION                    â”‚
â”‚ â€¢ transformations_applied â† "TRIM, UPPER"                            â”‚
â”‚ â€¢ source_semantic_field ğŸ” â† Vector-indexed for AI learning          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    mapping_feedback         â”‚         â”‚   transformation_library    â”‚
â”‚    (Rejected Suggestions)   â”‚         â”‚   (SQL Templates)           â”‚
â”‚                             â”‚         â”‚                             â”‚
â”‚ â€¢ feedback_id (PK)          â”‚         â”‚ â€¢ transformation_id (PK)    â”‚
â”‚ â€¢ suggested_src/tgt         â”‚         â”‚ â€¢ transformation_code       â”‚
â”‚ â€¢ user_comments             â”‚         â”‚ â€¢ transformation_expression â”‚
â”‚ â€¢ source_semantic_field ğŸ”  â”‚         â”‚ â€¢ category                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ” = Vector-indexed for AI search
                </pre>
            </div>
        </section>
        
        <!-- What Changed from V2 -->
        <section class="section">
            <h2 class="section-title">What Changed from V2?</h2>
            <div class="comparison">
                <div class="comparison-box before">
                    <h4>âŒ V2 (Complex)</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        Multiple tables for one mapping
                    </p>
                    <pre>mapped_fields (1 row)
  â””â”€â”€ mapping_details (N rows)
  â””â”€â”€ mapping_joins (N rows)
  â””â”€â”€ mapping_unions (N rows)
  â””â”€â”€ mapping_patterns (1 row)

7+ tables, complex joins,
sync issues between tables</pre>
                </div>
                <div class="comparison-box after">
                    <h4>âœ… V3 (Simple)</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
                        One row = one complete mapping
                    </p>
                    <pre>mapped_fields (1 row)
  â””â”€â”€ source_expression: "CONCAT(...)"
  â””â”€â”€ source_tables: "t1, t2"
  â””â”€â”€ source_columns: "col1, col2"

5 tables total, no joins needed,
SQL expression is source of truth</pre>
                </div>
            </div>
            
            <div class="highlight-box" style="margin-top: 2rem;">
                <h4 style="margin-bottom: 0.5rem;">ğŸ—‘ï¸ Tables Eliminated</h4>
                <ul style="color: var(--text-secondary); margin-left: 1.5rem;">
                    <li><code>mapping_details</code> â†’ Info now in <code>source_columns</code>, <code>source_tables</code></li>
                    <li><code>mapping_joins</code> â†’ Info now in <code>source_expression</code></li>
                    <li><code>mapping_unions</code> â†’ Info now in <code>source_expression</code></li>
                    <li><code>mapping_patterns</code> â†’ <code>mapped_fields</code> IS the pattern table now</li>
                </ul>
            </div>
        </section>
        
        <!-- Benefits -->
        <section class="section">
            <h2 class="section-title">Benefits</h2>
            <div class="benefits-grid">
                <div class="benefit">
                    <div class="benefit-icon">ğŸ¯</div>
                    <h4>Accurate Suggestions</h4>
                    <p>Vector search finds semantically similar fields, not just name matches</p>
                </div>
                <div class="benefit">
                    <div class="benefit-icon">ğŸ“š</div>
                    <h4>Pattern Learning</h4>
                    <p>AI learns from complete SQL expressions, not just column pairs</p>
                </div>
                <div class="benefit">
                    <div class="benefit-icon">âœï¸</div>
                    <h4>SQL Flexibility</h4>
                    <p>Users can write any SQL - joins, unions, CASE statements, etc.</p>
                </div>
                <div class="benefit">
                    <div class="benefit-icon">âš¡</div>
                    <h4>Simple Schema</h4>
                    <p>5 tables instead of 9 - easier to maintain and query</p>
                </div>
                <div class="benefit">
                    <div class="benefit-icon">ğŸš«</div>
                    <h4>Mistake Avoidance</h4>
                    <p>Won't repeat previously rejected suggestions</p>
                </div>
                <div class="benefit">
                    <div class="benefit-icon">ğŸ”„</div>
                    <h4>Hybrid Speed</h4>
                    <p>Parallel discovery + targeted context = fast & accurate</p>
                </div>
            </div>
        </section>
        
        <!-- Vector Indexes -->
        <section class="section">
            <h2 class="section-title">Vector Search Indexes</h2>
            <div class="benefits-grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));">
                <div class="benefit" style="border-left: 4px solid var(--primary);">
                    <div class="benefit-icon">ğŸ¯</div>
                    <h4>semantic_fields.semantic_field</h4>
                    <p><strong>Purpose:</strong> Find target fields matching source descriptions</p>
                    <p style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
                        Query: "Find targets similar to 'Patient social security number'"
                    </p>
                </div>
                <div class="benefit" style="border-left: 4px solid var(--secondary);">
                    <div class="benefit-icon">ğŸ“š</div>
                    <h4>mapped_fields.source_semantic_field</h4>
                    <p><strong>Purpose:</strong> Find similar past mappings for AI pattern learning</p>
                    <p style="margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
                        Query: "Find mappings with similar source characteristics"
                    </p>
                </div>
            </div>
            <p style="color: var(--text-secondary); margin-top: 1.5rem; font-size: 0.9rem;">
                <strong>Note:</strong> <code>mapping_feedback</code> uses exact lookup by target column (not vector search) 
                to keep costs low while still avoiding rejected mappings.
            </p>
        </section>
        
        <!-- Tech Stack -->
        <section class="section">
            <h2 class="section-title">Technology Stack</h2>
            <div class="benefits-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                <div class="benefit" style="text-align: center;">
                    <div class="benefit-icon">ğŸ”</div>
                    <h4>Vector Search</h4>
                    <p>Databricks Vector Search</p>
                </div>
                <div class="benefit" style="text-align: center;">
                    <div class="benefit-icon">ğŸ¤–</div>
                    <h4>LLM</h4>
                    <p>Databricks Foundation Model</p>
                </div>
                <div class="benefit" style="text-align: center;">
                    <div class="benefit-icon">ğŸ’¾</div>
                    <h4>Database</h4>
                    <p>Delta Lake</p>
                </div>
                <div class="benefit" style="text-align: center;">
                    <div class="benefit-icon">âš™ï¸</div>
                    <h4>Backend</h4>
                    <p>FastAPI (Python)</p>
                </div>
                <div class="benefit" style="text-align: center;">
                    <div class="benefit-icon">ğŸ–¥ï¸</div>
                    <h4>Frontend</h4>
                    <p>Vue 3 + PrimeVue</p>
                </div>
            </div>
        </section>
        
        <footer>
            <p>Smart Mapper V3 - Intelligent Data Field Mapping</p>
            <p style="font-size: 0.9rem; margin-top: 0.5rem;">Powered by Databricks AI</p>
        </footer>
    </div>
</body>
</html>
