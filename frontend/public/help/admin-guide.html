<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Guide - Smart Mapper V4</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #4a5568, #38a169);
            color: white;
            padding: 2.5rem 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 51, 102, 0.2);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .header p {
            font-size: 1.15rem;
            opacity: 0.95;
        }

        .section {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #4a5568;
        }

        .section h2 {
            color: #4a5568;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            border-bottom: 2px solid #38a169;
            padding-bottom: 0.5rem;
        }

        .section h3 {
            color: #4a5568;
            margin: 1.5rem 0 1rem 0;
            font-size: 1.3rem;
        }

        .section h4 {
            color: #4a5568;
            margin: 1rem 0 0.5rem 0;
            font-size: 1.1rem;
        }

        .section p {
            margin-bottom: 1rem;
            color: #555;
        }

        .section ul, .section ol {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .section ul li, .section ol li {
            margin: 0.5rem 0;
            color: #555;
        }

        .info-box {
            background: linear-gradient(135deg, #e8f4fd, #d4edda);
            padding: 1.25rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #38a169;
        }

        .info-box strong {
            color: #4a5568;
            font-size: 1.05rem;
        }

        .warning-box {
            background: linear-gradient(135deg, #fff3cd, #ffe8a1);
            padding: 1.25rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #ffc107;
        }

        .warning-box strong {
            color: #856404;
            font-size: 1.05rem;
        }

        code {
            background: #f1f1f1;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            color: #c7254e;
            font-size: 0.9rem;
        }

        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        table th {
            background: #4a5568;
            color: white;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
        }

        table td {
            padding: 0.75rem;
            border-bottom: 1px solid #dee2e6;
        }

        table tr:hover {
            background: #f8f9fa;
        }

        strong {
            color: #4a5568;
        }

        a {
            color: #38a169;
            text-decoration: underline;
            font-weight: 600;
        }

        a:hover {
            color: #2f855a;
        }

        .toc {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
        }

        .toc h2 {
            color: #4a5568;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .toc ul {
            list-style: none;
            margin-left: 0;
        }

        .toc ul li {
            margin: 0.5rem 0;
        }

        .toc ul li a {
            color: #38a169;
            text-decoration: none;
            font-weight: 500;
        }

        .toc ul li a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è Smart Mapper V4 Admin Guide</h1>
            <p>Configuration, management, and technical reference</p>
        </div>

        <div class="toc">
            <h2>üìë Table of Contents</h2>
            <ul>
                <li><a href="#overview">1. Admin Overview</a></li>
                <li><a href="#admin-users">2. Admin Users Configuration</a></li>
                <li><a href="#settings">3. System Settings</a></li>
                <li><a href="#semantic">4. Semantic Field Management</a></li>
                <li><a href="#pattern-import">5. Pattern Import</a></li>
                <li><a href="#troubleshooting">6. Troubleshooting</a></li>
            </ul>
        </div>

        <!-- SECTION 1: ADMIN OVERVIEW -->
        <div class="section" id="overview">
            <h2>1. Admin Overview</h2>
            
            <h3>Admin Capabilities</h3>
            <p>As an administrator, you have access to:</p>
            <ul>
                <li><strong>‚öôÔ∏è Configuration:</strong> Database, vector search, and AI model settings</li>
                <li><strong>üìä Semantic Management:</strong> Manage target field definitions</li>
                <li><strong>üì• Pattern Import:</strong> Bulk load historical mapping patterns</li>
                <li><strong>üë• Admin Users:</strong> Manage who has admin access</li>
                <li><strong>All User Features:</strong> Projects, mapping, AI suggestions</li>
            </ul>

            <h3>Checking Admin Status</h3>
            <ul>
                <li>Look at the badge next to your name in the header</li>
                <li>If it says <strong>"Admin"</strong> (green badge), you have admin access</li>
                <li>If it says <strong>"User"</strong> (grey badge), ask an admin to add your email to the admin users list</li>
            </ul>
        </div>

        <!-- SECTION 2: ADMIN USERS CONFIGURATION -->
        <div class="section" id="admin-users">
            <h2>2. Admin Users Configuration</h2>
            
            <h3>How Admin Access Works</h3>
            <p>Admin access in V4 is controlled by a list of email addresses, not Databricks groups. This provides simpler, more predictable access control.</p>

            <h3>Managing Admin Users</h3>
            <ol>
                <li>Navigate to <strong>Settings ‚Üí Security</strong></li>
                <li>Find the <strong>Admin Users</strong> section</li>
                <li>Add or remove email addresses from the list</li>
                <li>Click <strong>Save</strong></li>
            </ol>

            <h4>Example Admin Users List</h4>
            <pre>
david.galluzzo@gainwelltechnologies.com
jane.doe@gainwelltechnologies.com
john.smith@gainwelltechnologies.com</pre>

            <div class="info-box">
                <strong>üí° Note:</strong> Users must match their exact Databricks login email. Email matching is case-insensitive.
            </div>

            <h3>Configuration File</h3>
            <p>Admin users are also stored in <code>app_config.json</code>:</p>
            <pre>
{
  "security": {
    "admin_users": [
      "david.galluzzo@gainwelltechnologies.com",
      "jane.doe@company.com"
    ]
  }
}</pre>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Important:</strong> The legacy "Admin Group Name" field still exists but the admin users list takes precedence. We recommend using the admin users list for simplicity.
            </div>
        </div>

        <!-- SECTION 3: SETTINGS & CONFIGURATION -->
        <div class="section" id="settings">
            <h2>3. System Settings</h2>
            <p>Navigate to <strong>Configuration</strong> from the sidebar to manage system settings.</p>

            <h3>Database Configuration</h3>
            <p>Configure connection to your Databricks SQL Warehouse:</p>

            <table>
                <tr>
                    <th>Setting</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
                <tr>
                    <td><code>server_hostname</code></td>
                    <td>Your Databricks workspace URL</td>
                    <td>dbc-1234abcd-5678.cloud.databricks.com</td>
                </tr>
                <tr>
                    <td><code>http_path</code></td>
                    <td>SQL Warehouse HTTP path</td>
                    <td>/sql/1.0/warehouses/abc123def456</td>
                </tr>
                <tr>
                    <td><code>catalog</code></td>
                    <td>Unity Catalog name</td>
                    <td>oz_dev</td>
                </tr>
                <tr>
                    <td><code>schema</code></td>
                    <td>Schema containing mapping tables</td>
                    <td>silver_dmes_de</td>
                </tr>
            </table>

            <h3>Vector Search Configuration</h3>
            <table>
                <tr>
                    <th>Setting</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>endpoint_name</code></td>
                    <td>Vector Search endpoint name</td>
                </tr>
                <tr>
                    <td><code>semantic_index</code></td>
                    <td>Index for target field definitions</td>
                </tr>
                <tr>
                    <td><code>patterns_index</code></td>
                    <td>Index for historical mapping patterns</td>
                </tr>
            </table>

            <h3>AI Model Configuration</h3>
            <table>
                <tr>
                    <th>Setting</th>
                    <th>Description</th>
                    <th>Recommended</th>
                </tr>
                <tr>
                    <td><code>foundation_model_endpoint</code></td>
                    <td>LLM endpoint name</td>
                    <td>databricks-meta-llama-3-3-70b-instruct</td>
                </tr>
            </table>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Important:</strong> Ensure the SQL Warehouse is running before saving database configuration. Test connectivity on the Home page.
            </div>
        </div>

        <!-- SECTION 4: SEMANTIC MANAGEMENT -->
        <div class="section" id="semantic">
            <h2>4. Semantic Field Management</h2>
            <p>Navigate to <strong>Semantic Management</strong> from the sidebar.</p>

            <h3>About Semantic Fields</h3>
            <p>The semantic table contains all target field definitions that AI uses for matching. Each record represents one target column available for mapping.</p>

            <h3>Key Operations</h3>
            <ul>
                <li><strong>View:</strong> Browse all target fields</li>
                <li><strong>Search:</strong> Filter by table name, column name, or description</li>
                <li><strong>Add:</strong> Create new target field definitions</li>
                <li><strong>Edit:</strong> Update target field details</li>
                <li><strong>Delete:</strong> Remove target fields</li>
            </ul>

            <h3>Required Fields</h3>
            <table>
                <tr>
                    <th>Column</th>
                    <th>Purpose</th>
                </tr>
                <tr>
                    <td><code>tgt_table_name</code></td>
                    <td>Target table logical name</td>
                </tr>
                <tr>
                    <td><code>tgt_table_physical_name</code></td>
                    <td>Actual table name in database</td>
                </tr>
                <tr>
                    <td><code>tgt_column_name</code></td>
                    <td>Target column logical name</td>
                </tr>
                <tr>
                    <td><code>tgt_column_physical_name</code></td>
                    <td>Actual column name in database</td>
                </tr>
                <tr>
                    <td><code>tgt_comments</code></td>
                    <td>Description (critical for AI matching)</td>
                </tr>
                <tr>
                    <td><code>domain</code></td>
                    <td>Domain category (Member, Claims, etc.)</td>
                </tr>
            </table>

            <div class="info-box">
                <strong>üí° Best Practice:</strong> Write detailed, clear descriptions in <code>tgt_comments</code>. Better descriptions = better AI matches!
            </div>
        </div>

        <!-- SECTION 5: PATTERN IMPORT -->
        <div class="section" id="pattern-import">
            <h2>5. Pattern Import</h2>
            <p>The Pattern Import feature allows bulk loading of historical mappings as AI patterns.</p>

            <h3>Using Pattern Import</h3>
            <ol>
                <li>Navigate to <strong>Administration ‚Üí Pattern Import</strong></li>
                <li><strong>Step 1 - Upload:</strong> Upload a CSV file with historical mappings</li>
                <li><strong>Step 2 - Map Columns:</strong> Map your CSV columns to required fields</li>
                <li><strong>Step 3 - Process:</strong> AI analyzes patterns and generates join_metadata</li>
                <li><strong>Step 4 - Review:</strong> Review processed patterns before saving</li>
                <li><strong>Step 5 - Save:</strong> Save patterns to the mapped_fields table</li>
            </ol>

            <h3>CSV Format</h3>
            <table>
                <tr>
                    <th>Column</th>
                    <th>Required</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td><code>tgt_table_name</code></td>
                    <td>‚úÖ</td>
                    <td>Target table name (e.g., "MBR_CNTCT")</td>
                </tr>
                <tr>
                    <td><code>tgt_column_name</code></td>
                    <td>‚úÖ</td>
                    <td>Target column name (e.g., "ADDR_1_TXT")</td>
                </tr>
                <tr>
                    <td><code>source_expression</code></td>
                    <td>‚úÖ</td>
                    <td>Complete SQL expression</td>
                </tr>
                <tr>
                    <td><code>source_tables</code></td>
                    <td>Optional</td>
                    <td>Pipe-separated source tables</td>
                </tr>
                <tr>
                    <td><code>source_columns</code></td>
                    <td>Optional</td>
                    <td>Pipe-separated source columns</td>
                </tr>
            </table>

            <h3>Special Case Handling</h3>
            <p>Pattern Import automatically handles special source expressions:</p>
            <table>
                <tr>
                    <th>Source Expression</th>
                    <th>Pattern Type</th>
                    <th>Behavior</th>
                </tr>
                <tr>
                    <td><code>Auto Generated</code></td>
                    <td>AUTO_GENERATED</td>
                    <td>No SQL generated, marked as auto-mapped</td>
                </tr>
                <tr>
                    <td><code>Hard coded as NULL</code></td>
                    <td>HARDCODED</td>
                    <td>Generates SELECT NULL AS column</td>
                </tr>
                <tr>
                    <td><code>Hard coded as 'value'</code></td>
                    <td>HARDCODED</td>
                    <td>Generates SELECT 'value' AS column</td>
                </tr>
                <tr>
                    <td><code>N/A</code></td>
                    <td>NOT_APPLICABLE</td>
                    <td>Marked for review</td>
                </tr>
            </table>

            <div class="info-box">
                <strong>üí° Progress Tracking:</strong> Pattern Import shows real-time progress during save, displaying X/Y patterns saved and the current pattern name.
            </div>
        </div>

        <!-- SECTION 6: TROUBLESHOOTING -->
        <div class="section" id="troubleshooting">
            <h2>6. Troubleshooting</h2>

            <h3>Database Connection Issues</h3>
            <p><strong>Symptoms:</strong> "Database Connection: Error" on Home page</p>
            <ul>
                <li>Verify SQL Warehouse is running</li>
                <li>Check server hostname and HTTP path are correct</li>
                <li>Ensure catalog and schema names exist</li>
                <li>Verify all V4 tables exist (see Developer Guide for schema details)</li>
            </ul>

            <h3>Vector Search Issues</h3>
            <p><strong>Symptoms:</strong> "Vector Search: Not Available" or AI suggestions fail</p>
            <ul>
                <li>Check endpoint is created and online in Databricks</li>
                <li>Verify index names match exactly</li>
                <li>Wait 1-2 minutes after semantic table changes for sync</li>
            </ul>

            <h3>AI Model Issues</h3>
            <p><strong>Symptoms:</strong> "AI Model: Not Ready" or suggestions fail</p>
            <ul>
                <li>Verify model endpoint exists and is serving</li>
                <li>Wait for cold start on first request (30-60 seconds)</li>
                <li>Check app has permission to query endpoint</li>
            </ul>

            <h3>Admin Access Issues</h3>
            <p><strong>Symptoms:</strong> User shows "User" badge instead of "Admin"</p>
            <ul>
                <li>Verify user's email is in the admin users list</li>
                <li>Check email matches exactly (case-insensitive)</li>
                <li>User may need to refresh the page</li>
            </ul>

            <h3>Pattern Import Issues</h3>
            <p><strong>Symptoms:</strong> Patterns not saving or errors during import</p>
            <ul>
                <li>Check CSV format matches expected columns</li>
                <li>Verify target table/column names exist in semantic_fields</li>
                <li>Watch the progress indicator for specific errors</li>
                <li>Check backend logs for detailed error messages</li>
            </ul>

            <div class="info-box">
                <strong>üí° Need More Help?</strong> 
                <ul>
                    <li>Check Databricks workspace logs for detailed errors</li>
                    <li>Review application logs in Databricks Apps console</li>
                    <li>Contact your organization's Databricks admin</li>
                </ul>
            </div>

            <div class="info-box" style="background: linear-gradient(135deg, #f0e6ff, #e8f4fd); border-left-color: #7c3aed;">
                <strong>üìñ Database Schema Reference</strong>
                <p style="margin-top: 0.5rem;">
                    For detailed information about V4 database tables, schemas, and SQL files, 
                    see the <strong>Developer Guide</strong> (available from the Help menu).
                </p>
            </div>
        </div>

        <div class="section" style="background: linear-gradient(135deg, #e8f4fd, #f0f8ff); border-left-color: #38a169;">
            <h2>üéØ Quick Reference: Admin Tasks</h2>
            <table>
                <tr>
                    <th>Task</th>
                    <th>Location</th>
                    <th>Action</th>
                </tr>
                <tr>
                    <td>Add admin user</td>
                    <td>Settings ‚Üí Security</td>
                    <td>Add email to Admin Users list</td>
                </tr>
                <tr>
                    <td>Configure database</td>
                    <td>Settings ‚Üí Database</td>
                    <td>Update connection settings</td>
                </tr>
                <tr>
                    <td>Configure AI model</td>
                    <td>Settings ‚Üí AI Model</td>
                    <td>Update endpoint name</td>
                </tr>
                <tr>
                    <td>Add target field</td>
                    <td>Semantic Management</td>
                    <td>Click "Add Field"</td>
                </tr>
                <tr>
                    <td>Import patterns</td>
                    <td>Pattern Import</td>
                    <td>Upload CSV and follow wizard</td>
                </tr>
                <tr>
                    <td>Check system status</td>
                    <td>Home page</td>
                    <td>Review status indicators</td>
                </tr>
            </table>
            <p style="margin-top: 1rem; text-align: center; color: #666;">
                <strong>Version:</strong> Smart Mapper V4 - Target-First Workflow | <strong>Updated:</strong> December 2025
            </p>
        </div>
    </div>
</body>
</html>
